spring.application.name=tax-api

# Database configuration
spring.datasource.url=jdbc:postgresql://tax-db.cgqk1o9ntgf2.us-east-1.rds.amazonaws.com:5432/postgres
spring.datasource.username=postgres
spring.datasource.password=postgres
spring.jpa.show-sql=true
spring.jpa.properties.hibernate.dialect=org.hibernate.dialect.PostgreSQLDialect

# Health/liveness probes
management.endpoint.health.probes.enabled=true
management.health.db.enabled=false

# Make startup resilient if DB is unreachable so the app can boot and pass health checks
spring.sql.init.mode=never
spring.jpa.hibernate.ddl-auto=none
spring.jpa.open-in-view=false

# Hikari: do not fail fast on pool init; keep timeouts small
spring.datasource.hikari.initializationFailTimeout=0
spring.datasource.hikari.connectionTimeout=2000

# Actuator exposure and probe groups (be explicit)
management.endpoints.web.exposure.include=health,info
management.endpoint.health.show-details=never
management.endpoint.health.group.liveness.include=livenessState
management.endpoint.health.group.readiness.include=readinessState

# Allow graceful shutdown to reduce 143 (SIGTERM) noise during rollouts
server.shutdown=graceful
spring.lifecycle.timeout-per-shutdown-phase=20s

# Hibernate configuration for better connection handling
spring.datasource.hikari.maximum-pool-size=5
spring.datasource.hikari.minimum-idle=2
spring.datasource.hikari.connection-timeout=20000
spring.datasource.hikari.idle-timeout=300000

# Allow application to start even if DB is not available initially
spring.datasource.continue-on-error=true
spring.jpa.properties.hibernate.temp.use_jdbc_metadata_defaults=false

# Actuator configuration for health checks - cleaned and optimized
server.ssl.enabled=false
server.forward-headers-strategy=native
spring.mvc.produce-json-for-accept-header=true
management.endpoint.health.show-components=always
spring.web.resources.add-mappings=false

